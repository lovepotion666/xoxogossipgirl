<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Conversation | Master Stable v6.1</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">

<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

<link rel="stylesheet" href="https://fonts.cdnfonts.com/css/sf-pro-display">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@400;700&display=swap" rel="stylesheet">

<style>
:root {
    --pink: #ff4fd8;
    --hot: #ff1aa6;
    --glass: rgba(255, 255, 255, 0.04);
    --border: rgba(255, 255, 255, 0.1);
}

* { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }

body {
    background: radial-gradient(circle at 50% 0%, #1a0f33 0%, #050505 100%) fixed;
    color: #fff;
    font-family: 'SF Pro Display', 'Noto Sans Arabic', sans-serif;
    line-height: 1.5;
    overflow-x: hidden;
}

/* --- TITANIUM HEADER --- */
header {
    position: sticky; top: 0; z-index: 1000;
    padding: 20px;
    background: rgba(5, 5, 5, 0.7);
    backdrop-filter: blur(40px) saturate(180%);
    border-bottom: 0.5px solid var(--border);
    display: flex; align-items: center; justify-content: space-between;
}

.back-link { color: var(--pink); text-decoration: none; font-weight: 900; font-size: 13px; letter-spacing: 0.5px; }

/* --- CONTENT --- */
.view { max-width: 620px; margin: 25px auto; padding: 0 20px 180px; }

.master-card {
    background: var(--glass);
    backdrop-filter: blur(50px);
    border: 1px solid var(--border);
    border-radius: 35px;
    padding: 30px;
    margin-bottom: 40px;
}

.bubble {
    background: rgba(255, 255, 255, 0.02);
    border: 1px solid var(--border);
    border-radius: 24px;
    padding: 20px;
    margin-bottom: 12px;
}

/* --- THE DEEP FIX: INPUT BAR --- */
.fixed-footer {
    position: fixed; 
    bottom: 25px; /* Lifted slightly for better thumb reach */
    left: 15px; 
    right: 15px;
    z-index: 2000;
}

.input-pill {
    max-width: 580px;
    margin: 0 auto;
    background: rgba(20, 20, 20, 0.9);
    backdrop-filter: blur(30px) saturate(150%);
    -webkit-backdrop-filter: blur(30px) saturate(150%);
    border: 1px solid var(--border);
    border-radius: 50px; /* Perfect pill shape */
    padding: 6px 8px 6px 20px; /* Balanced inner spacing */
    display: flex; 
    align-items: center; 
    gap: 8px;
    box-shadow: 0 15px 40px rgba(0,0,0,0.7);
}

input {
    flex: 1; 
    min-width: 0; /* CRITICAL FIX: Allows input to shrink to fit button */
    background: transparent; 
    border: none; 
    color: #fff;
    font-size: 16px; 
    outline: none; 
    height: 44px;
    font-family: inherit;
}

.btn-send {
    flex-shrink: 0; /* CRITICAL FIX: Prevents button from being squashed */
    background: linear-gradient(135deg, var(--pink), var(--hot));
    color: #fff; 
    border: none; 
    padding: 0 22px; 
    height: 44px; /* Matches input height exactly */
    border-radius: 25px; 
    font-weight: 900; 
    font-size: 13px;
    cursor: pointer; 
    transition: all 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
    opacity: 0.2; 
    pointer-events: none;
    display: flex;
    align-items: center;
    justify-content: center;
}

.btn-send.active { opacity: 1; pointer-events: auto; transform: scale(1); }
.btn-send:active { transform: scale(0.92) brightness(1.2); }

.counter { 
    font-size: 10px; 
    font-weight: 900; 
    color: var(--pink); 
    opacity: 0.4; 
    margin-right: 5px;
    white-space: nowrap;
}

.v-tag { position: fixed; bottom: 8px; right: 20px; font-size: 9px; opacity: 0.2; font-weight: 900; }
</style>
</head>
<body>

<header>
    <a href="index.html" class="back-link"> FEED</a>
    <div style="font-size: 10px; font-weight: 900; color: #00ff88;">• LIVE</div>
</header>

<div class="view">
    <div id="anchor"></div>
    <div id="thread"></div>
</div>

<div class="fixed-footer">
    <div class="input-pill">
        <input type="text" id="msgIn" placeholder="Write a comment..." maxlength="250" autocomplete="off">
        <span class="counter" id="charCount">0/250</span>
        <button class="btn-send" id="sendBtn">SEND</button>
    </div>
</div>

<div class="v-tag">STABLE v6.1 | TITANIUM</div>

<script>
const firebaseConfig = { apiKey: "AIzaSyCTdVcJspQxXiq_Kd7ImL32xWsjv0HgENE", authDomain: "gossip-girl-4c9f2.firebaseapp.com", projectId: "gossip-girl-4c9f2", storageBucket: "gossip-girl-4c9f2.firebasestorage.app", messagingSenderId: "206020058212", appId: "1:206020058212:web:fb7c70aa1e3765e6691371" };
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const currentPostId = localStorage.getItem('currentPostId');

const input = document.getElementById('msgIn');
const btn = document.getElementById('sendBtn');
const counter = document.getElementById('charCount');

// FIX: Auto-scroll anchor logic
const scrollToEnd = () => window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });

// RENDER MASTER
db.ref('posts/' + currentPostId).once('value', snap => {
    const p = snap.val();
    if(p) {
        document.getElementById('anchor').innerHTML = `
            <div class="master-card">
                <div style="font-size: 20px; font-weight: 500;">${p.text}</div>
            </div>
        `;
    } else { location.replace('index.html'); }
});

// INPUT FEEDBACK
input.oninput = () => {
    const val = input.value.trim();
    counter.innerText = `${val.length}/250`;
    if(val.length > 0) btn.classList.add('active');
    else btn.classList.remove('active');
};

// LIVE THREAD
db.ref('comments/' + currentPostId).on('value', snap => {
    const thread = document.getElementById('thread');
    const data = snap.val();
    thread.innerHTML = '';
    if(data) {
        Object.keys(data).forEach(key => {
            const div = document.createElement('div');
            div.className = 'bubble';
            div.innerHTML = `<div style="font-size:10px; color:var(--pink); font-weight:900;">USER_${key.slice(-4).toUpperCase()}</div><div style="margin-top:5px;">${data[key].text}</div>`;
            thread.appendChild(div);
        });
        scrollToEnd();
    }
});

// SUBMIT FIX
btn.onclick = () => {
    const val = input.value.trim();
    if(!val) return;
    
    db.ref('comments/' + currentPostId).push({
        text: val,
        date: Date.now()
    }).then(() => {
        input.value = '';
        input.oninput();
        scrollToEnd();
    });
};
</script>
</body>
</html>
